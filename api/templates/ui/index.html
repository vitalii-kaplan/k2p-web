{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>k2p-web — KNIME → Python</title>

    <meta name="description" content="Convert KNIME workflows to Python/Jupyter using knime2py in an isolated container. Upload a minimal workflow bundle, get generated code." />
    <meta name="color-scheme" content="light dark" />
    <link rel="stylesheet" href="{% static 'ui/app.css' %}">
  </head>

  <body>
    <header id="site-header">
      <div class="container">
        <div class="brand">
          <span class="brand-title">k2p-web</span>
          <span class="brand-subtitle">KNIME → Python/Jupyter</span>
        </div>

        <nav class="nav">
          <a href="/api/schema/" target="_blank" rel="noreferrer">API schema</a>
          <a href="/healthz" target="_blank" rel="noreferrer">healthz</a>
          <a href="/admin/" target="_blank" rel="noreferrer">admin</a>
        </nav>
      </div>
    </header>

    <main id="site-main">
      <div class="container">
        <section class="intro">
          <h1>Convert KNIME workflows to Python</h1>
          <p>Upload a minimal workflow bundle (<code>workflow.knime</code> + per-node <code>settings.xml</code>).</p>
          <p>No data needed for conversion. Only configuration is uploaded.</p>
          <p>The server runs <code>knime2py</code> in an isolated container and returns generated code and graphs.</p>
        </section>

        <!-- Work area (React mounts here) -->
        <section class="panel" aria-label="Converter">
          <div class="panel-header">
            <div class="panel-title">Converter</div>
            <div class="badges">
              <span class="badge"><span class="dot knime"></span> KNIME</span>
              <span class="badge"><span class="dot python"></span> Python</span>
            </div>
          </div>
          <div class="panel-body">
            <div id="root"></div>

            <noscript>
              <div class="card">
                This page requires JavaScript to build the workflow manifest and upload the bundle.
              </div>
            </noscript>
          </div>
        </section>

        <section class="details" aria-label="About">
          <h2>How it works</h2>
          <ol>
            <li>Select a folder that contains <code>workflow.knime</code> in the root.</li>
            <li>Review the exact file list that will be uploaded (manifest).</li>
            <li>Upload the bundle as a ZIP and download the results when ready.</li>
          </ol>

          <h2>Privacy and security note</h2>
          <p>
            <code>settings.xml</code> can include secrets (DB credentials, API keys, server URLs, file paths).
            Always review the manifest before uploading.
          </p>

          <h2>Outputs</h2>
          <ul>
            <li><code>*.py</code> workbook</li>
            <li><code>*.ipynb</code> notebook</li>
            <li><code>*.json</code> and <code>*.dot</code> graph exports</li>
          </ul>
        </section>
      </div>
    </main>

    <footer id="site-footer">
      <div class="container">
        <small>
          k2p-web uses knime2py. KNIME® is a trademark of KNIME AG. This project is not affiliated with KNIME AG.
        </small>
      </div>
    </footer>

    <!-- React (UMD, no build step) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom-client.production.min.js" crossorigin></script>

    <!-- HTM: JSX-like template literals without a build step -->
    <script src="https://unpkg.com/htm@3.1.1/dist/htm.umd.js" crossorigin></script>

    <!-- JSZip -->
    <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js" crossorigin></script>

    <!-- Your app (defer so DOM is ready) -->
    <script defer src="{% static 'ui/manifest_utils.js' %}"></script>
    <script defer src="{% static 'ui/app_view.js' %}"></script>
    <script defer src="{% static 'ui/app.js' %}"></script>
  </body>
</html>
